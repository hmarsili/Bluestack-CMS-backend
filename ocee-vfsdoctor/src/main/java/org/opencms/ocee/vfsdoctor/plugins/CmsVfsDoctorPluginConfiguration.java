package org.opencms.ocee.vfsdoctor.plugins;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import org.apache.commons.digester3.Digester;
import org.dom4j.Element;
import org.opencms.configuration.A_CmsXmlConfiguration;
import org.opencms.configuration.I_CmsXmlConfiguration;
import org.opencms.ocee.base.CmsOceeManager;
import org.opencms.ocee.vfsdoctor.CmsVfsDoctorManager;
import org.opencms.ocee.vfsdoctor.CmsVfsDoctorPluginSqlQuery;
import org.opencms.ocee.vfsdoctor.I_CmsVfsDoctorPlugin;

public class CmsVfsDoctorPluginConfiguration extends A_CmsXmlConfiguration implements I_CmsXmlConfiguration {
   private static final String Ò000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000new = "dbprovider";
   private static final String õ000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000int = CmsVfsDoctorManager.getInstance().getModuleLocation() + "plugins/";
   private static final String Ø000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000void = "vfsdoctor-plugin.dtd";
   private static final String ô000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000null = "http://www.alkacon.com/dtd/6.0/";
   private static final String o000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000super = "default";
   private static final String ø000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000float = "plugin";
   private static final String Ö000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000return = "queries";
   private static final String ö000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000if = "query";
   private static final String OO00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000for = "spec-queries";
   private static final String Ô000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000String = "spec-query";
   private I_CmsVfsDoctorPlugin Õ000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000class;
   private List Ó000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000Object = new ArrayList(4);

   public CmsVfsDoctorPluginConfiguration(I_CmsVfsDoctorPlugin plugin) {
      this.setXmlFileName(plugin.getName() + "-plugin.xml");
      this.Õ000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000class = plugin;
   }

   public void addQuery(CmsVfsDoctorPluginSqlQuery query) {
      this.Ó000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000Object.add(query);
   }

   public void addXmlDigesterRules(Digester digester) {
      digester.addObjectCreate("*/plugin/queries/query", CmsVfsDoctorPluginSqlQuery.class);
      digester.addCallMethod("*/plugin/queries/query", "setName", 1);
      digester.addCallParam("*/plugin/queries/query", 0, "name");
      digester.addCallMethod("*/plugin/queries/query/default", "setDefaultQuery", 0);
      digester.addCallMethod("*/plugin/queries/query/spec-queries/spec-query", "addSpecQuery", 2);
      digester.addCallParam("*/plugin/queries/query/spec-queries/spec-query", 0, "dbprovider");
      digester.addCallParam("*/plugin/queries/query/spec-queries/spec-query", 1);
      digester.addSetNext("*/plugin/queries/query", "addQuery");
   }

   public Element generateXml(Element parent) {
      Element pluginElement = parent.addElement("plugin");
      Element queriesElement = pluginElement.addElement("queries");
      Iterator it = this.getQueries().iterator();

      while(it.hasNext()) {
         CmsVfsDoctorPluginSqlQuery query = (CmsVfsDoctorPluginSqlQuery)it.next();
         Element queryElement = queriesElement.addElement("query");
         queryElement.addAttribute("name", query.getName());
         Element defaultElement = queryElement.addElement("default");
         defaultElement.addText(query.getDefaultQuery());
         Element specQueriesElement = queryElement.addElement("spec-queries");
         Iterator iter = query.getSpecQueries().keySet().iterator();

         while(iter.hasNext()) {
            String dbProvider = (String)iter.next();
            Element specQueryElement = specQueriesElement.addElement("spec-query");
            specQueryElement.addAttribute("dbprovider", dbProvider);
            specQueryElement.addText((String)query.getSpecQueries().get(dbProvider));
         }
      }

      return pluginElement;
   }

   public String getDtdFilename() {
      return "vfsdoctor-plugin.dtd";
   }

   public String getDtdSystemLocation() {
      return õ000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000int;
   }

   public String getDtdUrlPrefix() {
      return "http://www.alkacon.com/dtd/6.0/";
   }

   public I_CmsVfsDoctorPlugin getPlugin() {
      return this.Õ000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000class;
   }

   public List getQueries() {
      return this.Ó000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000Object;
   }

   protected void initMembers() {
      CmsOceeManager.getInstance().checkOceeVersion();
   }
}
